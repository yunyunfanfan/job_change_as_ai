<!--
	此示例下载自 https://echarts.apache.org/examples/zh/editor.html?c=bar-simple&code=1Rp_bxNH9v9I-Q7Tnio7V8fs2nEggXAKToyQeggV1KpnRdXau7ZXbHat3TXYICTo0XJwUOj1rr2jd1eKegVVKgcV10socB_mYif5i6_Q92Zmd2d2144Tyh-1SOKdee_N-_3evGXfPrIQ_xA1T_of3u8_urj94Y3NZw-SEJMTdcf2fHJ08cT7J4_9bpkskOJBArT6jz7YfHJvY_2P258_3rx9GX5v3_5b_-t7_Yc3Xzz9Q__3Nzcf33nx9OrkxOQEQG_f_fvW1e_ZIXRhcGd9cOPBxrM7gLv1zaXBow8GXzwefPZw48lHG2tXN9a-3Vj7ETBePL3eX_9h68q3_Wv3-9fXgQACPL-3_Y-7g_8-AoD_X7y0_dUP8Ljx5AE89v90ffCfS_1bn2xfvDn468ewEghQdyzHPaFZhu8bIMT5yQkCn-NGU_PNM8Y8OU-F-vd6_8mfya8WlbKyXCHZI1bHML3WFAPGT8N1bH-eZDhIJhdteaYOdGBrvzo3Wy5lckiR8dq_dgfYjUB9pw2QAFqeXVquABUEZXIMbt4CUYQDLecsUnWbNS2rzio5os4VcqRQnMsRJT8zxXAZ40xnoNH-jWtMAcKRRhf4hiMV-smwnQuc_-NGx3c1K6aGyvLS7Nwcyb5nWMDFEEUwoFRFlOcWF_fPjqWISqWilAtjK6JQmgEdqPBLLRVDRYwr7QnHM1OsPre4VCkrJHvUNQx7iLQMJt3shSPFufGkLRcqhaXy-Gan0hZAUGp7Ju2Owk5OXDjIwy8Z-IU8GfzlIYRg_8HtjfWrwwO_rvlG03FNw4OoqWZqpmXiD_CecQ1dN338dqZgdPHvuZbZ6mRW4FiG7GpnlzRfQ0zGFPAShFwucLpcaA8Gc56c0SDuvHlSVfJFBTxeyauFEv4p7Z9ZCa0owRVU6gaFAweofub2D4ErzlAAVd1P6RWH0SuWaHypJZXSOzAHcJMTKFkgm2egUo5rq1wzgVyoBy4Zfg1ko1qB7EParlM3PM_QuWYSmai6Eg_KcCVy3OrKSPMWA_Nu373c__ry5q2P0izMzZNvOO6yVm9ls6ZvrOaIaetGd4osHA54Q7brHdc1bP-kr9VPA9cKnB1s2eB_8XWmI9w5BjRhg59VpcTJm0RlukRYPDXPdB-xAs854vfaxjFd4iUijpuofiAu2KLKcZB8AB_H9HzN9d8DPFEoAZ5BGbYehwG-ga9UyoIiGO1AE-LmMiMZ32pp3nHYhZ2GZnlGKn2zQbKBOqdEZeAnIuC7HRFfNsU7mgUgARWu8jSF4UcSJjRxChAXKvKCN4PD0ikiBAOXQSC-ogcpSiiLaN2VfLvjtbI8mYSqQZfKoWVy3LQ5arycIAP7jqzmQm39hqhknigRsZWpdKeRPGBBcIELiEB_DYnDGYjDte8HX366ffHHreefpAUhxVwM4Lb-98_Bx__qr31DshUoAVCCGh277puOTYAH3XBxNdvWXG3VyxGtbYa-wMzcPUbjawG3mIGzSiAVg4h8JQKZDUDQy17jEFNwot9x7TBOY8EToRfkE3jgRPtFeV_yrAhqJgnFXSuCKckwUdwDFFNKPlrLu0bb0upGNoNKw2SckdFpT1huNDHKhfawGpGIkhTDqGnuu6butwBjRjnIfUQiyXylDD-Gy1mvO46rZ6vMNFBOQjeLBB0Oj6lSxJGMrUb5iVGoKiuAEHK5jxSko7oFHqgR9HQatIjTU9-vOb7vYBJPkYa5w8pUlSb0IKMRRIN2B59T0dBHRCR-VmHEWUwTkfOknFkYcWaEjl4VIDN0zizEdnDP4XQ5RXmDbbHgEDMxZinoEduO1Ws6ttQjtjTcimXttmPaPrYb8jJ-ql3gNdR8UP7TIIC99G1oFBn3o7Y5fRlAeAx6IyqE37OSQjRMCzqUIJLy2LfGzvN81zmNirEd2-DNKc_39A-mUJ4GjwRpkBSXyODLRxvPPgWzDT670v_uc5Itd2pGMiHi6kslRFiUttVYjnnpfDc6S71kRqrvItOgGhg8RL4ceHuL8bFDnEfT0GBKy67ijm606bKKGUrcoBezt4061jPBM7vzIKyc2gSv7M0zVoSlswg2HyIIOy3DbLbgfvVbzW_lV7VuFi4kobqmGaEpnjFZRy5YHu6GJ2iUR1cgGn4h23nMS9ETZSMnLPSkbcaLGNC7oDQ-GqxQhcuMTLPFlyWTlCekzAjHPRz0u5MOx5UzNO8u4feqkBFI6bJaWs2wTrH2DK9A5NdEVZSpvO9UzK6hQ24Cqpk3MjtXoabrdNpiDaq3TEuHlJmoN-cDFBc4hC6JF6uQaYx_lvkTyR5ByAWpSkgUw1IYVsCw6AmhcWH4CQi1xwMitxlBH_NRkjzOJ2nNGdy5svnd89jZyWrKmcE5jKjx0YVTnt6Ehk_BTymziDQMEmxS0VZNC7Jc5pSJ44njxlnytrOqST1JHOekeQ6YVMU8GQd5l6fCTM2x9GG0kLVFy2yCo2VYsRkF-Y7h-mZdswKMVVPXLbFLSOtEhCw_OgHJaV9I_zskJMCT0XivInRHYtuSvPeVYK7-xfOtr-4Pn6s7bdrEhGWrBrdLDFpbL6OVcdjYaDQC3fmmH_Mh5jeZk6BiMDLEYa1HTliaDxOUVVHjltFAuKQp6DSyoMQGiSfTu7xdOFXkTIXZlK2RTkQdHEWP5phiq8ihLaMJzYXEpA5jAshsO0_h4gooigpwGWvSGs4-6ez3DHdVkWccXR3VgIz6KvWozqR35CYUDczb6DTovrExt-84lm8Cc6LXgIhNA1WsdU0vPkUOmB7Np8QDupsGLSqQDBpz3o0nplTYNLp0WsoAoAnN29gVQ0k7VHP3HcayJl2QWK8czATbsTGgOBp7rS1e_E27bnV0w-M3_6kEK_JsjN0Asm3WvkPHOqLsplFBoaCrzRzy2prN0v3C67rpwfShN2_almkb0zXLgenZquY2TXua-Vmp3T1Yg5bZcKddTTc73ryqwBJrRelX3nvS71F-mGZRkgGe2tB0w3fk7uDrhw_tQwYSaoyxKWoKEcHCbK451A6xDBhOvmTitBGBM-SRnuiQTdeUo5bnptIboiPyIMyoCiwLYzjWcgcbsTDOqDIRMKyvmfZbWFahF4CpqMxKdxHcX44MVsT5-46eSIwll-hNiLCF_gtYaYkXt95yAAtCAkAgY8V3k5kDV7EL-Hmzx26zcFuDFzt2E_IpZELC_w2ZCmAa4Vp-NdyykMFKNZyBU2b9NKYtr4VvzegQPckkRGGCR4aA7hEfWvRWQTNYUejUAkqI5rqQSuLDFAbHWK-CKeF9ZBwEwz9MrGGBKxaLQJVfOwtieMWCpjfMU2myirsUdgQtzU2s_-xOtevSrvEOD2N-uMOF_jZdHOZxcAeH8_NK6RV4YbKWUS2n1g8sO3SXHCZQIHgCzKQlT77HwWPFRUkvLqJHiFO4tmX63Jdj_i7kyl-yw7PqJF1Tw_teveNBDQA63NeDdo8P-NlEEF9uzQuvS3I8gUvvlPLRe-hz4E5wRTQt2uehbiSNjzic9pd7Opu_-d7r0UE_u4ezA9QdD9-F-lNZwMHsGKqHQTR20XGHEcefIULqxGEn--yaucg24_FG4XfHWngf2R1vku3GYS5AiLjjcyf83wM_AQ&enc=deflate
	⚠ 请注意，该图表不是 Apache ECharts 官方示例，而是由用户代码生成的。请注意鉴别其内容。
-->
<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  
  <!-- Uncomment this line if you want to dataTool extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/dataTool.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use gl extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-gl/dist/echarts-gl.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-stat extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-stat/dist/ecStat.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-graph-modularity extension
  <script type="text/javascript" src="https://echarts.apache.org/zh/js/vendors/echarts-graph-modularity/dist/echarts-graph-modularity.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use map
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
  -->
  <!-- Uncomment these two lines if you want to use bmap extension
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/bmap.min.js"></script>
  -->

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });
    var app = {};
    
    var option;

    // ================= 1. 全局配置 =================
const GAP_SIZE = 3; // 层级之间的间隙大小（像素）

// 颜色配置
// 根据你的要求更新了三个主色，并自动匹配了侧面深色、顶面亮色和流向透明色
const colorPalette = {
    Negative: { // 对应 #A0C0EF (Blueish)
        front: '#A0C0EF',
        side:  '#7196C5', // 侧面加深
        top:   '#C6DEFF', // 顶面提亮
        flow:  'rgba(160, 192, 239, 0.4)', // 对应主色的半透明
        text:  '#000000'
    },
    Neutral: { // 对应 #FED699 (Yellowish)
        front: '#FED699',
        side:  '#C9AA76', // 侧面加深
        top:   '#FFF0C2', // 顶面提亮
        flow:  'rgba(254, 214, 153, 0.4)', 
        text:  '#000000'
    },
    Positive: { // 对应 #9ADFC0 (Greenish)
        front: '#9ADFC0',
        side:  '#72B396', // 侧面加深
        top:   '#C2F2DC', // 顶面提亮
        flow:  'rgba(154, 223, 192, 0.4)',
        text:  '#000000'
    }
};

// ================= 2. 数据定义 =================
const categories = ['bilibili', 'reddit', 'v2ex', 'zhihu'];
const rawData = [
    // Negative, Neutral, Positive
    { values: [0.300, 0.125, 0.574] },
    { values: [0.213, 0.288, 0.497] },
    { values: [0.348, 0.117, 0.534] },
    { values: [0.359, 0.151, 0.489] }
];

const seriesNames = ['Negative', 'Neutral', 'Positive'];
let processedData = {
    Negative: [],
    Neutral: [],
    Positive: []
};

// ================= 3. 数据预处理 =================
rawData.forEach((item, index) => {
    let currentStack = 0;
    let nextStack = 0;
    const nextItem = rawData[index + 1];

    item.values.forEach((val, typeIdx) => {
        const typeName = seriesNames[typeIdx];
        
        const startY = currentStack;
        const endY = currentStack + val;
        
        let nextStartY = 0;
        let nextEndY = 0;
        let hasNext = false;
        
        if (nextItem) {
            hasNext = true;
            const nextVal = nextItem.values[typeIdx];
            nextStartY = nextStack;
            nextEndY = nextStack + nextVal;
            nextStack += nextVal;
        }

        processedData[typeName].push([
            index, val, startY, endY, nextStartY, nextEndY, hasNext ? 1 : 0
        ]);
        
        currentStack += val;
    });
});

// ================= 4. 渲染逻辑 =================

// A. 渲染连接带 (Flow)
function renderFlow(params, api) {
    const xIndex = api.value(0);
    const hasNext = api.value(6);
    if (!hasNext) return;

    const startY = api.value(2);
    const endY = api.value(3);
    const nextStartY = api.value(4);
    const nextEndY = api.value(5);
    const seriesName = params.seriesName.replace('Flow', '');
    const colorCfg = colorPalette[seriesName];

    const barWidth = 40; 
    
    const currentCenter = api.coord([xIndex, 0]);
    const nextCenter = api.coord([xIndex + 1, 0]);
    
    const x1 = currentCenter[0] + barWidth / 2;
    const x2 = nextCenter[0] - barWidth / 2;
    
    const y1_bottom = api.coord([xIndex, startY])[1];
    let   y1_top    = api.coord([xIndex, endY])[1];
    const y2_bottom = api.coord([xIndex + 1, nextStartY])[1];
    let   y2_top    = api.coord([xIndex + 1, nextEndY])[1];

    y1_top += GAP_SIZE;
    y2_top += GAP_SIZE;

    return {
        type: 'polygon',
        shape: {
            points: [
                [x1, y1_bottom],
                [x1, y1_top],
                [x2, y2_top],
                [x2, y2_bottom]
            ]
        },
        style: {
            fill: colorCfg.flow,
            stroke: 'none'
        }
    };
}

// B. 渲染 3D 柱体 + 文字 (Cube)
function renderCube(params, api) {
    const xIndex = api.value(0);
    const val = api.value(1);
    const startY = api.value(2);
    const endY = api.value(3);
    const seriesName = params.seriesName;
    const colorCfg = colorPalette[seriesName];

    const center = api.coord([xIndex, 0]);
    const x = center[0];
    const y_bottom = api.coord([xIndex, startY])[1];
    let   y_top    = api.coord([xIndex, endY])[1];

    y_top += GAP_SIZE;

    const barWidth = 40;
    const depth = 12;

    const frontRect = {
        x: x - barWidth / 2,
        y: y_top,
        width: barWidth,
        height: Math.max(0, y_bottom - y_top) 
    };

    const sidePoints = [
        [frontRect.x + frontRect.width, frontRect.y + frontRect.height],
        [frontRect.x + frontRect.width, frontRect.y],
        [frontRect.x + frontRect.width + depth, frontRect.y - depth],
        [frontRect.x + frontRect.width + depth, frontRect.y + frontRect.height - depth]
    ];

    const topPoints = [
        [frontRect.x, frontRect.y],
        [frontRect.x + barWidth, frontRect.y],
        [frontRect.x + barWidth + depth, frontRect.y - depth],
        [frontRect.x + depth, frontRect.y - depth]
    ];

    const labelText = (val * 100).toFixed(1) + '%';

    return {
        type: 'group',
        children: [
            { type: 'rect', shape: frontRect, style: { fill: colorCfg.front } },
            { type: 'polygon', shape: { points: sidePoints }, style: { fill: colorCfg.side } },
            { type: 'polygon', shape: { points: topPoints }, style: { fill: colorCfg.top } },
            // 文字标签
            {
                type: 'text',
                style: {
                    text: labelText,
                    fill: colorCfg.text,
                    fontFamily: 'Times New Roman',
                    fontSize: 12,
                    fontWeight: 'bold',
                    textAlign: 'center',
                    textVerticalAlign: 'middle'
                },
                x: frontRect.x + frontRect.width / 2,
                y: frontRect.y + frontRect.height / 2
            }
        ]
    };
}

// ================= 5. 图表配置 =================
option = {
    backgroundColor: '#fff',
    title: {
        text: 'Sentiment by Platform',
        left: 'center',
        top: 20,
        textStyle: {
            fontFamily: 'Times New Roman',
            fontSize: 26,
            fontWeight: 'bold',
            color: '#000'
        }
    },
    legend: {
        data: ['Negative', 'Neutral', 'Positive'],
        top: 30,
        right: 30,
        orient: 'vertical',
        itemGap: 10,
        textStyle: {
            fontFamily: 'Times New Roman',
            fontSize: 14
        },
        icon: 'roundRect'
    },
    tooltip: {
        trigger: 'axis',
        textStyle: { fontFamily: 'Times New Roman' },
        formatter: function(params) {
            let res = params[0].name + '<br/>';
            params.forEach(p => {
                if (!p.seriesName.includes('Flow')) {
                    const val = (p.value[1] * 100).toFixed(1) + '%';
                    res += '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:' + p.color + ';"></span>';
                    res += p.seriesName + ': ' + val + '<br/>';
                }
            });
            return res;
        }
    },
    grid: {
        left: '5%',
        right: '10%', 
        bottom: '10%',
        top: '15%',
        containLabel: true
    },
    xAxis: {
        type: 'category',
        data: categories,
        name: 'Platform',
        nameLocation: 'end',
        nameGap: 10,
        nameTextStyle: {
            fontFamily: 'Times New Roman',
            fontSize: 14,
            fontWeight: 'bold',
            padding: [30, 0, 0, 0]
        },
        axisLabel: {
            fontFamily: 'Times New Roman',
            fontSize: 14,
            margin: 20
        },
        axisTick: { show: false },
        axisLine: {
            show: true,
            symbol: ['none', 'arrow'],
            symbolSize: [10, 15],
            lineStyle: { color: '#333', width: 2 }
        }
    },
    yAxis: {
        type: 'value',
        name: 'Share',
        nameTextStyle: {
            fontFamily: 'Times New Roman',
            fontSize: 16,
            fontWeight: 'bold',
            align: 'left',
            padding: [0, 0, 0, -30]
        },
        max: 1.05,
        axisLabel: {
            fontFamily: 'Times New Roman',
            formatter: function(value) {
                if (value > 1) return '';
                return (value * 100).toFixed(0) + '%';
            }
        },
        splitLine: { show: false }, 
        axisLine: {
            show: true,
            symbol: ['none', 'arrow'],
            symbolSize: [10, 15],
            lineStyle: { color: '#333', width: 2 }
        }
    },
    series: [
        { type: 'custom', name: 'NegativeFlow', renderItem: renderFlow, data: processedData.Negative, z: 1, silent: true },
        { type: 'custom', name: 'NeutralFlow', renderItem: renderFlow, data: processedData.Neutral, z: 1, silent: true },
        { type: 'custom', name: 'PositiveFlow', renderItem: renderFlow, data: processedData.Positive, z: 1, silent: true },
        
        { type: 'custom', name: 'Negative', renderItem: renderCube, data: processedData.Negative, z: 2, itemStyle: { color: colorPalette.Negative.front } },
        { type: 'custom', name: 'Neutral', renderItem: renderCube, data: processedData.Neutral, z: 2, itemStyle: { color: colorPalette.Neutral.front } },
        { type: 'custom', name: 'Positive', renderItem: renderCube, data: processedData.Positive, z: 2, itemStyle: { color: colorPalette.Positive.front } }
    ]
};

    if (option && typeof option === 'object') {
      myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>